// test-project/socket-test.html
<!DOCTYPE html>
<html>
<head>
    <title>Socket.io Test Client</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1>Socket.io Test Client</h1>
    
    <div>
        <label>JWT Token:</label>
        <input type="text" id="token" placeholder="Paste your JWT token here" style="width: 500px;">
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()">Disconnect</button>
    </div>
    
    <div>
        <h3>Send Message</h3>
        <input type="text" id="receiverId" placeholder="Receiver User ID">
        <input type="text" id="messageContent" placeholder="Message content">
        <button onclick="sendMessage()">Send Message</button>
    </div>
    
    <div>
        <h3>Join Conversation</h3>
        <input type="text" id="otherUserId" placeholder="Other User ID">
        <button onclick="joinConversation()">Join Conversation</button>
    </div>
    
    <div>
        <h3>Events Log</h3>
        <div id="log" style="border: 1px solid #ccc; height: 400px; overflow-y: scroll; padding: 10px;"></div>
    </div>

    <script>
        let socket = null;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function connect() {
            const token = document.getElementById('token').value;
            if (!token) {
                alert('Please enter JWT token');
                return;
            }
            
            socket = io('http://localhost:5000', {
                auth: {
                    token: token
                }
            });
            
            // Connection events
            socket.on('connect', () => {
                log('‚úÖ Connected to server!');
            });
            
            socket.on('disconnect', () => {
                log('‚ùå Disconnected from server');
            });
            
            socket.on('connect_error', (error) => {
                log('üö´ Connection error: ' + error.message);
            });
            
            // User status events
            socket.on('user_online', (data) => {
                log('üü¢ User online: ' + data.username + ' (' + data.userId + ')');
            });
            
            socket.on('user_offline', (data) => {
                log('üî¥ User offline: ' + data.username + ' (' + data.userId + ')');
            });
            
            // Connection request events
            socket.on('connection_request_received', (data) => {
                log('üîó New connection request from: ' + data.connection.requester.username);
                log('üìù Message: ' + data.message);
            });
            
            socket.on('connection_request_responded', (data) => {
                log('‚úÖ Connection request ' + data.action + 'ed by: ' + data.connection.receiver.username);
                log('üìù Message: ' + data.message);
            });
            
            // Message events
            socket.on('new_message', (data) => {
                log('üí¨ New message from: ' + data.senderUsername);
                log('üìù Content: ' + data.content);
            });
            
            socket.on('message_notification', (data) => {
                log('üîî Message notification: ' + data.notification);
            });
            
            socket.on('messages_read', (data) => {
                log('üëÅÔ∏è Messages read by: ' + data.readByUsername);
            });
            
            socket.on('message_deleted', (data) => {
                log('üóëÔ∏è Message deleted by user: ' + data.deletedBy);
            });
        }
        
        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        }
        
        function sendMessage() {
            if (!socket) {
                alert('Please connect first');
                return;
            }
            
            const receiverId = document.getElementById('receiverId').value;
            const content = document.getElementById('messageContent').value;
            
            if (!receiverId || !content) {
                alert('Please enter receiver ID and message content');
                return;
            }
            
            socket.emit('send_message', {
                receiverId: receiverId,
                content: content,
                messageType: 'text'
            });
            
            log('üì§ Sent message to: ' + receiverId);
            document.getElementById('messageContent').value = '';
        }
        
        function joinConversation() {
            if (!socket) {
                alert('Please connect first');
                return;
            }
            
            const otherUserId = document.getElementById('otherUserId').value;
            
            if (!otherUserId) {
                alert('Please enter other user ID');
                return;
            }
            
            socket.emit('join_conversation', {
                otherUserId: otherUserId
            });
            
            log('üë• Joined conversation with: ' + otherUserId);
        }
    </script>
</body>
</html>
